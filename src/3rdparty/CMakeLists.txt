set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${COVISEDIR}/${ARCHSUFFIX}/bin")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${COVISEDIR}/${ARCHSUFFIX}/lib")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY "${COVISEDIR}/${ARCHSUFFIX}/lib")

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG "${COVISEDIR}/${DBG_ARCHSUFFIX}/bin")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_DEBUG "${COVISEDIR}/${DBG_ARCHSUFFIX}/lib")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG "${COVISEDIR}/${DBG_ARCHSUFFIX}/lib")

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/bin")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELEASE "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/lib")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/lib")

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/bin")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/lib")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/lib")


set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_MINSIZEREL "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/bin")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_MINSIZEREL "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/lib")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL "${COVISEDIR}/${DBG_ARCHSUFFIX}opt/lib")

if (COVISE_USE_VISIONARAY)
   using(Boost optional)
   set(VSNRAY_ENABLE_CUDA ${COVISE_USE_CUDA} CACHE BOOL "CUDA for Visionaray" FORCE)
   set(VSNRAY_ENABLE_EXAMPLES FALSE CACHE BOOL "Visionaray examples" FORCE)
   set(VSNRAY_ENABLE_VIEWER FALSE CACHE BOOL "Visionaray viewer" FORCE)
   if(COVISE_USE_VISIBILITY)
      if(CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
         set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fvisibility=hidden")
         set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fvisibility=hidden")
      endif()

      if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
         set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fvisibility=hidden")
         set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fvisibility=hidden")
      endif()
   endif()

   IF(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
       set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fabi-version=0")
       set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fabi-version=0")
   ENDIF()
   
   add_subdirectory(visionaray)
   set(VISIONARAY_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/visionaray/include")
  
   if(MSVC)
      set_target_properties(visionaray PROPERTIES OUTPUT_NAME "libvisionaray")
      set(VISIONARAY_LIBRARY "${COVISEDIR}/${ARCHSUFFIX}/lib/libvisionaray${CMAKE_STATIC_LIBRARY_SUFFIX}")
      set(VISIONARAY_LIBRARY_RELEASE "${COVISEDIR}/${ARCHSUFFIX}/lib/libvisionaray${CMAKE_STATIC_LIBRARY_SUFFIX}")
   else()
     if(BUILD_SHARED_LIBS)
        set(VISIONARAY_LIBRARY "${COVISEDIR}/${ARCHSUFFIX}/lib/libvisionaray${CMAKE_SHARED_LIBRARY_SUFFIX}")
     else()
        set(VISIONARAY_LIBRARY "${COVISEDIR}/${ARCHSUFFIX}/lib/libvisionaray${CMAKE_STATIC_LIBRARY_SUFFIX}")
     endif()
   endif()

endif()

SET(DESKVOX_USE_CUDA ${COVISE_USE_CUDA} CACHE BOOL "CUDA for Virvo" FORCE)
SET(DESKVOX_USE_QT4 ${COVISE_USE_QT4} CACHE BOOL "Qt4 for Virvo" FORCE)
SET(DESKVOX_USE_RAYREND_BSPLINE OFF)
SET(DESKVOX_USE_RAYREND_CSPLINE OFF)

if (COVISE_USE_VIRVO)
   using(GLEW optional)
   if (NOT GLEW_FOUND)
      message("Cannot build Virvo: no GLEW - maybe disable COVISE_USE_VIRVO?")
   endif()
   # search for Boost components required by Virvo with covise_find_package:
   # avoids the problem that Virvo does not find Boost in $EXTERNLIBS
   using(Boost optional)
   if (COVISE_USE_VISIONARAY)
      using(Visionaray)
   endif()
   if (NOT Boost_FOUND)
      message("Cannot build Virvo: no Boost - maybe disable COVISE_USE_VIRVO?")
   endif()
   set(saved_prefix_path ${CMAKE_PREFIX_PATH})
   set(CMAKE_PREFIX_PATH "$ENV{EXTERNLIBS}/volpack" ${CMAKE_PREFIX_PATH})
   set(CMAKE_PREFIX_PATH "$ENV{EXTERNLIBS}/gdcm" ${CMAKE_PREFIX_PATH})
   set(CMAKE_PREFIX_PATH "$ENV{EXTERNLIBS}/nifti" ${CMAKE_PREFIX_PATH})
   set(CMAKE_PREFIX_PATH "$ENV{EXTERNLIBS}/teem" ${CMAKE_PREFIX_PATH})
   add_definitions(-DHAVE_CONFIG_H)
   ADD_SUBDIRECTORY(deskvox)
   set(${CMAKE_PREFIX_PATH} ${saved_prefix_path})
   covise_export_target(virvo_fileio)
   covise_export_target(virvo)
   if (OPENSCENEGRAPH_FOUND)
      covise_export_target(virvo_osg)
   else()
      message("Cannot build virvo_osg: no OpenSceneGraph - maybe disable COVISE_USE_VIRVO?")
   endif()
endif()

