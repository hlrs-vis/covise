/* This file is part of COVISE.

   You can use it under the terms of the GNU Lesser General Public License
   version 2.1 or later, see lgpl-2.1.txt.

 * License: LGPL 2+ */


#include "pqFLEPanel.h"

#include <QLayout>
#include <QLabel>

#include "vtkSMProxy.h"
#include "pqProxy.h"

#define UNSTEADY "Unsteady"
#define VELOCITY_FILE "VelocityFile"
#define MODE "Mode"
#define INTEGRATION_TIME "IntegrationTime"
#define INTEGRATION_LENGTH "IntegrationLength"
#define TIME_INTERVALS "TimeIntervals"
#define SEP_FACTOR_MIN "SepFactorMin"

char *getLabelName(const char *widgetName)
{
    static char buf[256];
    // ######## REVERSE-ENGINEERED HACK !!!!!! #################################:
    // THIS MUST BE CONSISTENT WITH Qt/Components/pqNamedWidgets.cxx: createPanelLabel()
    sprintf(buf, "%s_label", widgetName);
    return buf;
}

pqFLEPanel::pqFLEPanel(pqProxy *pxy, QWidget *p)
    : pqAutoGeneratedObjectPanel(pxy, p)
{
    QObject::connect(this->findChild<QWidget *>(UNSTEADY),
                     SIGNAL(stateChanged(int)),
                     this,
                     SLOT(onUnsteadyChanged(int)));
    onUnsteadyChanged(0); // HACK

    QObject::connect(this->findChild<QWidget *>(MODE),
                     SIGNAL(currentIndexChanged(int)),
                     this,
                     SLOT(onModeChanged(int)));
    onModeChanged(0); // HACK
}

pqFLEPanel::~pqFLEPanel()
{
}

void pqFLEPanel::onUnsteadyChanged(int state)
{
    QWidget *VelocityFileWidget;
    QWidget *VelocityFileLabel;

    if (!(VelocityFileWidget = this->findChild<QWidget *>(VELOCITY_FILE)))
    {
        printf("pqFLEPanel.cxx: error: %s = NULL\n", VELOCITY_FILE);
    }
    if (!(VelocityFileLabel = this->findChild<QWidget *>(getLabelName(VELOCITY_FILE))))
    {
        printf("pqFLEPanel.cxx: error: %s Label = NULL\n", VELOCITY_FILE);
    }

    if (state)
    {
        VelocityFileWidget->setEnabled(true);
        VelocityFileLabel->setEnabled(true);
    }
    else
    {
        VelocityFileWidget->setEnabled(false);
        VelocityFileLabel->setEnabled(false);
    }
}

void pqFLEPanel::onModeChanged(int index)
{
    bool integrationTimeEnabled = false;
    bool integrationLengthEnabled = false;
    bool timeIntervalsEnabled = false;
    bool sepFactorMinEnabled = false;

    //QString type = this->findChild<QWidget*>("Mode")->itemText(index);

    //if (type == "FTLE") {
    if (index == 0)
    {
        integrationTimeEnabled = true;
    }
    else if (index == 1)
    {
        integrationLengthEnabled = true;
    }
    else if (index == 2)
    { // FSLE
        integrationTimeEnabled = true;
        timeIntervalsEnabled = true;
        sepFactorMinEnabled = true;
    }
    else if (index == 3)
    { // FTLEM
        integrationTimeEnabled = true;
        timeIntervalsEnabled = true;
    }
    else if (index == 4)
    { // FTLEA
        integrationTimeEnabled = true;
        timeIntervalsEnabled = true;
    }

    QWidget *IntegrationTimeWidget;
    QWidget *IntegrationTimeLabel;
    QWidget *IntegrationLengthWidget;
    QWidget *IntegrationLengthLabel;
    QWidget *TimeIntervalsWidget;
    QWidget *TimeIntervalsLabel;
    QWidget *SepFactorMinWidget;
    QWidget *SepFactorMinLabel;

    if (!(IntegrationTimeWidget = this->findChild<QWidget *>(INTEGRATION_TIME)))
    {
        printf("pqFLEPanel.cxx: error: %s = NULL\n", INTEGRATION_TIME);
    }
    if (!(IntegrationTimeLabel = this->findChild<QWidget *>(getLabelName(INTEGRATION_TIME))))
    {
        printf("pqFLEPanel.cxx: error: %s Label = NULL\n", INTEGRATION_TIME);
    }

    if (!(IntegrationLengthWidget = this->findChild<QWidget *>(INTEGRATION_LENGTH)))
    {
        printf("pqFLEPanel.cxx: error: %s = NULL\n", INTEGRATION_LENGTH);
    }
    if (!(IntegrationLengthLabel = this->findChild<QWidget *>(getLabelName(INTEGRATION_LENGTH))))
    {
        printf("pqFLEPanel.cxx: error: %s Label = NULL\n", INTEGRATION_LENGTH);
    }

    if (!(TimeIntervalsWidget = this->findChild<QWidget *>(TIME_INTERVALS)))
    {
        printf("pqFLEPanel.cxx: error: %s = NULL\n", TIME_INTERVALS);
    }
    if (!(TimeIntervalsLabel = this->findChild<QWidget *>(getLabelName(TIME_INTERVALS))))
    {
        printf("pqFLEPanel.cxx: error: %s Label = NULL\n", TIME_INTERVALS);
    }

    if (!(SepFactorMinWidget = this->findChild<QWidget *>(SEP_FACTOR_MIN)))
    {
        printf("pqFLEPanel.cxx: error: %s = NULL\n", SEP_FACTOR_MIN);
    }
    if (!(SepFactorMinLabel = this->findChild<QWidget *>(getLabelName(SEP_FACTOR_MIN))))
    {
        printf("pqFLEPanel.cxx: error: %s Label = NULL\n", SEP_FACTOR_MIN);
    }

    IntegrationTimeWidget->setEnabled(integrationTimeEnabled);
    IntegrationTimeLabel->setEnabled(integrationTimeEnabled);

    IntegrationLengthWidget->setEnabled(integrationLengthEnabled);
    IntegrationLengthLabel->setEnabled(integrationLengthEnabled);

    TimeIntervalsWidget->setEnabled(timeIntervalsEnabled);
    TimeIntervalsLabel->setEnabled(timeIntervalsEnabled);

    SepFactorMinWidget->setEnabled(sepFactorMinEnabled);
    SepFactorMinLabel->setEnabled(sepFactorMinEnabled);
}
